{"version": 2, "width": 100, "height": 38, "timestamp": 1769548535, "idle_time_limit": 2.0, "env": {"SHELL": "/bin/bash", "TERM": "xterm-256color"}, "title": "Step 3: Match Receipt to CSV Transaction"}
[0.074195, "o", "\u001b[2J\u001b[H\r\n\u001b[1;33m══════════════════════════════════════════════════════════════════════\u001b[0m\r\n\u001b[1;33m  Step 3: Match Receipt to Bank Transaction\u001b[0m\r\n\u001b[1;33m══════════════════════════════════════════════════════════════════════\u001b[0m\r\n\r\n"]
[1.074267, "o", "\u001b[37mAfter labelling receipts (Step 2b), link them to bank CSV transactions.\u001b[0m\r\n\u001b[37mThis prevents duplicate entries when importing to hledger.\u001b[0m\r\n\r\n"]
[3.07456, "o", "\u001b[90mSetting up demo environment...\u001b[0m\r\n"]
[3.181537, "o", "\u001b[90mDone.\u001b[0m\r\n\r\n"]
[3.681741, "o", "\r\n\u001b[1;36m────────────────────────────────────────────────────────────\u001b[0m\r\n\u001b[1;36m  Input: Bank CSV Transactions\u001b[0m\r\n\u001b[1;36m────────────────────────────────────────────────────────────\u001b[0m\r\n\r\n"]
[4.181997, "o", "\u001b[1;37m$ cat /tmp/match_demo_duz4nq0a/triodos_2025.csv\u001b[0m\r\n\r\n"]
[4.487076, "o", "15-01-2025,NL123,\"42,17\",debit,Ekoplaza,NL456,IC,groceries payment,\"1000,00\"\r\n14-01-2025,NL234,\"15,50\",debit,AH,NL789,IC,groceries ah,\"1042,17\"\r\n\r\n"]
[5.487157, "o", "\r\n\u001b[1;36m────────────────────────────────────────────────────────────\u001b[0m\r\n\u001b[1;36m  Input: Receipt Label (from Step 2b)\u001b[0m\r\n\u001b[1;36m────────────────────────────────────────────────────────────\u001b[0m\r\n\r\n"]
[5.987433, "o", "\u001b[1;37m$ cat /tmp/match_demo_duz4nq0a/receipt_labels/da3902fb202c97f923e4ccc75c93b1982dbbdcfcbdce464658aa58d565c430d4/receipt_image_to_obj_label.json\u001b[0m\r\n\r\n"]
[6.288738, "o", "{\r\n  \"ai_receipt_categorisation\": null,\r\n  \"net_bought_items\": {\r\n    \"account_transactions\": [\r\n      {\r\n        \"account\": {\r\n          \"account_holder\": \"at\",\r\n          \"account_type\": \"debit\",\r\n          \"bank\": \"triodos\",\r\n          \"base_currency\": \"EUR\"\r\n        },\r\n        \"change_returned\": 0,\r\n        \"currency\": \"EUR\",\r\n        \"tendered_amount_out\": 42.17\r\n      }\r\n    ],\r\n    \"category\": null,\r\n    \"description\": \"groceries:ekoplaza\",\r\n    \"group_discount\": 0,\r\n    \"quantity\": 1,\r\n    \"round_amount\": null,\r\n    \"tax_per_unit\": 0,\r\n    \"the_date\": \"2025-01-15T10:30:00\",\r\n    \"unit_price\": null\r\n  },\r\n  \"net_returned_items\": null,\r\n  \"raw_img_filepath\": \"/tmp/match_demo_duz4nq0a/receipt_images_input/ekoplaza.jpg\",\r\n  \"receipt_category\": \"groceries:ekoplaza\",\r\n  \"receipt_owner_address\": null,\r\n  \"shop_identifier\": {\r\n    \"address\": {\r\n      \"city\": \"Amsterdam\",\r\n      \"country\": \"Netherlands\",\r\n      \"house_nr\": \"123\",\r\n      \"street\": \"Kalverstraat\",\r\n      \"zipcode\": \"1012AB\"\r\n    },\r\n    \"name\":"]
[6.288856, "o", " \"Ekoplaza\",\r\n    \"shop_account_nr\": null\r\n  },\r\n  \"subtotal\": null,\r\n  \"the_date\": \"2025-01-15T10:30:00\",\r\n  \"total_tax\": 7.35,\r\n  \"transaction_hash\": null\r\n}\r\n"]
[7.288935, "o", "\r\n\u001b[1;36m────────────────────────────────────────────────────────────\u001b[0m\r\n\u001b[1;36m  Running: hledger_preprocessor --link-receipts-to-transactions\u001b[0m\r\n\u001b[1;36m────────────────────────────────────────────────────────────\u001b[0m\r\n\r\n"]
[7.789202, "o", "\u001b[1;37m$ hledger_preprocessor --config config.yaml --link-receipts-to-transactions\u001b[0m\r\n\r\n"]
[11.876965, "o", "<frozen runpy>:128: RuntimeWarning: 'hledger_preprocessor.__main__' found in sys.modules after import of package 'hledger_preprocessor', but prior to execution of 'hledger_preprocessor.__main__'; this may result in unpredictable behaviour\r\r\n"]
[11.879396, "o", "DEBUG: args parsed, link_receipts_to_transactions=True\r\r\n"]
[11.883244, "o", "DEBUG: config loaded\r\r\n"]
[11.889289, "o", "DEBUG: loaded 1 receipts from dir\r\r\nDEBUG: entering models/matching block\r\r\n"]
[13.647387, "o", "2026-01-27 22:15:49.094740: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:477] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered\r\r\n"]
[13.665112, "o", "WARNING: All log messages before absl::InitializeLog() is called are written to STDERR\r\r\nE0000 00:00:1769548549.112518   26929 cuda_dnn.cc:8310] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered\r\r\n"]
[13.670564, "o", "E0000 00:00:1769548549.118143   26929 cuda_blas.cc:1418] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered\r\r\n"]
[13.685854, "o", "2026-01-27 22:15:49.133395: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.\r\r\nTo enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.\r\r\n"]
[16.165855, "o", "Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.52, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.\r\r\n"]
[19.476815, "o", "DEBUG: models loaded\r\r\nDEBUG: calling manage_matching_manual_receipt_objs_to_account_transactions\r\r\n"]
[19.481496, "o", "STARTING MATCHING PROCESS\r\r\n"]
[19.498755, "o", "\r\r\nUnmatched AccountTransaction of at:triodos:debit amount: 42.17 [EUR]\r\r\nEvaluating csv txn amount:  42.17 [EUR  ] amount_range=   0 tnx date:2025-01-15 00:00:00 (out-in=  42.17-      0)\r\r\n"]
[19.499077, "o", "Transaction MATCH FOUND! 42.17\r\r\nEvaluating csv txn amount:   15.5 [EUR  ] amount_range=   0 tnx date:2025-01-14 00:00:00 (out-in=   15.5-      0)\r\r\n"]
[19.499924, "o", "WARNING: GenericCsv Transaction found in first tnx:GenericCsvTransaction(account=Account(base_currency=<Currency.EUR: 'EUR'>, account_holder='at', bank='triodos', account_type='checking'), the_date=datetime.datetime(2025, 1, 15, 0, 0), tendered_amount_out=42.17, change_returned=0, balance_after=None, description='groceries payment', other_party_name='Ekoplaza', other_party_account_name='NL456', transaction_code=<TransactionCode.DEBIT: 'debit'>, bic=None, original_transaction=None, extra={'nr_in_batch': 0, 'extra': {}})\r\r\n"]
[19.500207, "o", "WARNING: No original for: <class 'hledger_preprocessor.TransactionObjects.AccountTransaction.AccountTransaction'> with value:\r\r\nAccountTransaction(account=Account(base_currency=<Currency.EUR: 'EUR'>, account_holder='at', bank='triodos', account_type='debit'), the_date=datetime.datetime(2025, 1, 15, 10, 30), tendered_amount_out=42.17, change_returned=0, original_transaction=None, parent_receipt_category=None)\r\r\n"]
[19.50173, "o", "WARNING: No original for: <class 'hledger_preprocessor.TransactionObjects.AccountTransaction.AccountTransaction'> with value:\r\r\nAccountTransaction(account=Account(base_currency=<Currency.EUR: 'EUR'>, account_holder='at', bank='triodos', account_type='debit'), the_date=datetime.datetime(2025, 1, 15, 10, 30), tendered_amount_out=42.17, change_returned=0, original_transaction=None, parent_receipt_category=None)\r\r\n"]
[19.502353, "o", "receipt_transaction.original_transaction=GenericCsvTransaction(account=Account(base_currency=<Currency.EUR: 'EUR'>, account_holder='at', bank='triodos', account_type='checking'), the_date=datetime.datetime(2025, 1, 15, 0, 0), tendered_amount_out=42.17, change_returned=0, balance_after=None, description='groceries payment', other_party_name='Ekoplaza', other_party_account_name='NL456', transaction_code=<TransactionCode.DEBIT: 'debit'>, bic=None, original_transaction=None, extra={'nr_in_batch': 0, 'extra': {}})\r\r\n"]
[19.504658, "o", "exporting latest_receipt\r\r\n"]
[19.507247, "o", "{'ai_receipt_categorisation': None,\r\r\n "]
[19.508454, "o", "'net_bought_items': {'account_transactions': [{'account': {'account_holder': 'at',\r\r\n                                                            'account_type': 'debit',\r\r\n                                                            "]
[19.508743, "o", "'bank': 'triodos',\r\r\n                                                            'base_currency': 'EUR'},\r\r\n                                                'change_returned': 0,\r\r\n                                                "]
[19.509074, "o", "'original_transaction': {'account': {'account_holder': 'at',\r\r\n                                                                                     'account_type': 'checking',\r\r\n                                                                                     'bank': 'triodos',\r\r\n                                                                                     'base_currency': 'EUR'},\r\r\n                                                                         'balance_after': None,\r\r\n                                                                         'bic': None,\r\r\n                                                                         "]
[19.509249, "o", "'change_returned': 0,\r\r\n                                                                         'description': 'groceries '\r\r\n                                                                                        'payment',\r\r\n                                                                         "]
[19.509539, "o", "'extra': {'extra': {},\r\r\n                                                                                   'nr_in_batch': 0},\r\r\n                                                                         'original_transaction': None,\r\r\n                                                                         'other_party_account_name': 'NL456',\r\r\n                                                                         'other_party_name': 'Ekoplaza',\r\r\n                                                                         'tendered_amount_out': 42.17,\r\r\n                                                                         "]
[19.50973, "o", "'the_date': '2025-01-15T00:00:00',\r\r\n                                                                         'transaction_code': <TransactionCode.DEBIT: 'debit'>},\r\r\n                                                'parent_receipt_category': None,\r\r\n                                                'tendered_amount_out': 42.17,\r\r\n                                                'the_date': '2025-01-15T10:30:00'}],\r\r\n                "]
[19.50997, "o", "      'category': None,\r\r\n                      'description': 'groceries:ekoplaza',\r\r\n                      'group_discount': 0,\r\r\n                      'quantity': 1,\r\r\n                      'round_amount': None,\r\r\n                      'tax_per_unit': 0,\r\r\n                      'the_date': '2025-01-15T10:30:00',\r\r\n                      'unit_price': None},\r\r\n 'net_returned_items': None,\r\r\n 'raw_img_filepath': '/tmp/match_demo_duz4nq0a/receipt_images_input/ekoplaza.jpg',\r\r\n 'receipt_category': 'groceries:ekoplaza',\r\r\n 'receipt_owner_address': None,\r\r\n "]
[19.510061, "o", "'shop_identifier': {'address': {'city': 'Amsterdam',\r\r\n                                 'country': 'Netherlands',\r\r\n                                 'house_nr': '123',\r\r\n                                 'street': 'Kalverstraat',\r\r\n                                 'zipcode': '1012AB'},\r\r\n                     "]
[19.510286, "o", "'name': 'Ekoplaza',\r\r\n                     'shop_account_nr': None},\r\r\n 'subtotal': None,\r\r\n 'the_date': '2025-01-15T10:30:00',\r\r\n 'total_tax': 7.35,\r\r\n "]
[19.51037, "o", "'transaction_hash': None}\r\r\nEXPORTING to:\r\r\n/tmp/match_demo_duz4nq0a/receipt_labels/da3902fb202c97f923e4ccc75c93b1982dbbdcfcbdce464658aa58d565c430d4/receipt_image_to_obj_label.json"]
[20.061413, "o", "\r"]
[20.262203, "o", "\r\r\nexported latest_receipt\r\r\nWARNING: Popped old config, tied to receipt updated it with new config\r\r\nignore_keys={'nr_in_batch'}"]
[20.612753, "o", "\r"]
[20.813136, "o", "\r\r\nignore_keys={'nr_in_batch'}"]
[21.163785, "o", "\r"]
[21.364172, "o", "\r\r\nignore_keys={'nr_in_batch'}"]
[21.714782, "o", "\r"]
[21.915109, "o", "\r\r\nignore_keys={'nr_in_batch'}"]
[22.265677, "o", "\r"]
[22.466053, "o", "\r\r\nEverything went better than expected :)\r\r\nreceipt_transaction.original_transaction=GenericCsvTransaction(account=Account(base_currency=<Currency.EUR: 'EUR'>, account_holder='at', bank='triodos', account_type='checking'), the_date=datetime.datetime(2025, 1, 15, 0, 0), tendered_amount_out=42.17, change_returned=0, balance_after=None, description='groceries payment', other_party_name='Ekoplaza', other_party_account_name='NL456', transaction_code=<TransactionCode.DEBIT: 'debit'>, bic=None, original_transaction=None, extra={'nr_in_batch': 0, 'extra': {}})\r\r\nDONE WITH ALL MATCHING\r\r\nDEBUG: finished manage_matching_manual_receipt_objs_to_account_transactions\r\r\n"]
[23.403064, "o", "\r\n"]
[23.503352, "o", "\r\n\u001b[1;32m✓ Matching completed successfully!\u001b[0m\r\n\r\n"]
[24.503611, "o", "\r\n\u001b[1;36m────────────────────────────────────────────────────────────\u001b[0m\r\n\u001b[1;36m  Result: Receipt Linked to Transaction\u001b[0m\r\n\u001b[1;36m────────────────────────────────────────────────────────────\u001b[0m\r\n\r\n"]
[25.004002, "o", "\u001b[1;37m$ cat /tmp/match_demo_duz4nq0a/receipt_labels/da3902fb202c97f923e4ccc75c93b1982dbbdcfcbdce464658aa58d565c430d4/receipt_image_to_obj_label.json\u001b[0m\r\n\r\n"]
[25.308293, "o", "{\r\n    \"config\": {\r\n        \"accounts\": [\r\n            {\r\n                \"account\": {\r\n                    \"base_currency\": \"EUR\",\r\n                    \"account_holder\": \"at\",\r\n                    \"bank\": \"triodos\",\r\n                    \"account_type\": \"checking\"\r\n                },\r\n                \"input_csv_filename\": \"triodos_2025.csv\",\r\n                \"csv_column_mapping\": {\r\n                    \"csv_column_mapping\": [\r\n                        [\r\n                            \"the_date\",\r\n                            \"date\"\r\n                        ],\r\n                        [\r\n                            \"\",\r\n                            \"\"\r\n                        ],\r\n                        [\r\n                            \"tendered_amount_out\",\r\n                            \"amount\"\r\n                        ],\r\n                        [\r\n                            \"transaction_code\",\r\n                            \"\"\r\n                        ],\r\n                        [\r\n                            \"othe"]
[25.308613, "o", "r_party_name\",\r\n                            \"\"\r\n                        ],\r\n                        [\r\n                            \"other_party_account_name\",\r\n                            \"\"\r\n                        ],\r\n                        [\r\n                            \"\",\r\n                            \"\"\r\n                        ],\r\n                        [\r\n                            \"description\",\r\n                            \"description\"\r\n                        ],\r\n                        [\r\n                            \"\",\r\n                            \"\"\r\n                        ]\r\n                    ]\r\n                },\r\n                \"tnx_date_columns\": {\r\n                    \"csv_column_mapping\": [\r\n                        [\r\n                            \"the_date\",\r\n                            \"date\"\r\n                        ],\r\n                        [\r\n                            \"description\",\r\n                            \"description\"\r\n                        ]\r\n                    ]\r\n"]
[25.308769, "o", "                }\r\n            },\r\n            {\r\n                \"account\": {\r\n                    \"base_currency\": \"EUR\",\r\n                    \"account_holder\": \"at\",\r\n                    \"bank\": \"triodos\",\r\n                    \"account_type\": \"debit\"\r\n                },\r\n                \"input_csv_filename\": null,\r\n                \"csv_column_mapping\": {\r\n                    \"csv_column_mapping\": null\r\n                },\r\n                \"tnx_date_columns\": {\r\n                    \"csv_column_mapping\": null\r\n                }\r\n            }\r\n        ],\r\n        \"dir_paths\": {\r\n            \"root_finance_path\": \"/tmp/match_demo_duz4nq0a\",\r\n            \"working_subdir\": \"working_dir\",\r\n            \"receipt_images_input_dir\": \"receipt_images_input\",\r\n            \"hledger_plot_dir\": \"hledger_plots\",\r\n            \"receipt_images_processed_dir\": \"receipt_images_processed\",\r\n            \"receipt_labels_dir\": \"receipt_labels\",\r\n            \"asset_transaction_csvs_dir\": \"asset_transaction_csvs\",\r\n            \"pre_pro"]
[25.308825, "o", "cessed_output_dir\": null\r\n        },\r\n        \"file_names\": {\r\n            \"start_journal_filepath\": \"/tmp/match_demo_duz4nq0a/start_pos/2024.journal\",\r\n            \"root_journal_filename\": \"all-years.journal\",\r\n            \"tui_label_filename\": \"receipt_image_to_obj_label\",\r\n            \"receipt_img\": {\r\n                \"processing_metadata_ext\": \".json\",\r\n                \"rotate\": \"_rotated\",\r\n                \"rotate_ext\": \".jpg\",\r\n                \"crop\": \"_cropped\",\r\n                \"crop_ext\": \".jpg\"\r\n            },\r\n            \"categories_filename\": \"categories.yaml\"\r\n        },\r\n        \"categorisation\": {\r\n            \"quick\": true\r\n        },\r\n        \"csv_encoding\": \"utf-8\",\r\n        \"matching_algo\": {\r\n            \"days\": 2,\r\n            \"amount_range\": 0,\r\n            \"days_month_swap\": true,\r\n            \"multiple_receipts_per_transaction\": false\r\n        }\r\n    },\r\n    \"raw_img_filepath\": \"/tmp/match_demo_duz4nq0a/receipt_images_input/ekoplaza.jpg\",\r\n    \"the_date\": \"2025-01-15T10:30:00\",\r\n    \""]
[25.308926, "o", "shop_identifier\": {\r\n        \"name\": \"Ekoplaza\",\r\n        \"address\": {\r\n            \"street\": \"Kalverstraat\",\r\n            \"house_nr\": \"123\",\r\n            \"zipcode\": \"1012AB\",\r\n            \"city\": \"Amsterdam\",\r\n            \"country\": \"Netherlands\"\r\n        },\r\n        \"shop_account_nr\": null\r\n    },\r\n    \"net_bought_items\": {\r\n        \"quantity\": 1,\r\n        \"description\": \"groceries:ekoplaza\",\r\n        \"the_date\": \"2025-01-15T10:30:00\",\r\n        \"account_transactions\": [\r\n            {\r\n                \"account\": {\r\n                    \"base_currency\": \"EUR\",\r\n                    \"account_holder\": \"at\",\r\n                    \"bank\": \"triodos\",\r\n                    \"account_type\": \"debit\"\r\n                },\r\n                \"the_date\": \"2025-01-15T10:30:00\",\r\n                \"tendered_amount_out\": 42.17,\r\n                \"change_returned\": 0,\r\n                \"original_transaction\": {\r\n                    \"account\": {\r\n                        \"base_currency\": \"EUR\",\r\n                        \"account_holder\": "]
[25.309093, "o", "\"at\",\r\n                        \"bank\": \"triodos\",\r\n                        \"account_type\": \"checking\"\r\n                    },\r\n                    \"the_date\": \"2025-01-15T00:00:00\",\r\n                    \"tendered_amount_out\": 42.17,\r\n                    \"change_returned\": 0,\r\n                    \"balance_after\": null,\r\n                    \"description\": \"groceries payment\",\r\n                    \"other_party_name\": \"Ekoplaza\",\r\n                    \"other_party_account_name\": \"NL456\",\r\n                    \"transaction_code\": \"debit\",\r\n                    \"bic\": null,\r\n                    \"original_transaction\": null,\r\n                    \"extra\": {\r\n                        \"nr_in_batch\": 0,\r\n                        \"extra\": {}\r\n                    }\r\n                },\r\n                \"parent_receipt_category\": null\r\n            }\r\n        ],\r\n        \"tax_per_unit\": 0,\r\n        \"group_discount\": 0,\r\n        \"category\": null,\r\n        \"round_amount\": null,\r\n        \"unit_price\": null\r\n    },\r\n    \"net_returned"]
[25.309218, "o", "_items\": null,\r\n    \"subtotal\": null,\r\n    \"total_tax\": 7.35,\r\n    \"receipt_owner_address\": null,\r\n    \"ai_receipt_categorisation\": null,\r\n    \"transaction_hash\": null,\r\n    \"receipt_category\": \"groceries:ekoplaza\"\r\n}\r\n\u001b[33m(No matching transaction found within date margin)\u001b[0m\r\n\r\n"]
[26.309312, "o", "\u001b[1;37mWhy this matters:\u001b[0m\r\n\r\n  \u001b[32m✓\u001b[0m No duplicate entries in your journal\r\n  \u001b[32m✓\u001b[0m Receipt metadata attached to bank transaction\r\n  \u001b[32m✓\u001b[0m Full audit trail: receipt → bank statement\r\n\r\n"]
[27.309566, "o", "\u001b[1;36mNext step:\u001b[0m Run ./start.sh to import transactions to hledger\r\n\r\n"]
